---
id: 386
title: 'CI for Flex Mobile Applications – Part 5:'
date: 2014-04-04T15:20:56+00:00
author: admin
layout: post
guid: http://www.tiefenauer.info/?p=386
permalink: /ci-for-flex-mobile-applications-part-5-static-code-analysis/
frutiful_posts_template:
  - "2"
  - "2"
categories:
  - Coding
  - Technical
tags:
  - ant
  - as3
  - continuous integration
  - flex
  - FlexUnit
  - jenkins
  - mobile
  - testing
series:
  - Continuous Integration for Flex Apps
---
<div class="seriesmeta">
  This entry is part 6 of 9 in the series <a href="http://www.tiefenauer.info/series/flex-ci/" class="series-35" title="Continuous Integration for Flex Apps">Continuous Integration for Flex Apps</a>
</div>

<div class="fruitful_description_box">
  <div class="fruitful_description shadow-type-1 " id="desc-box-91">
    <span class="top_line"></span>
    
    <div class="text" style=" font-size: 40px; text-transform : uppercase; text-align: center; font-weight: 300; line-height: 1.2;">
      Static Code Analysis 
    </div>
    
    <span class="bottom_line"></span>
  </div>
</div>

<div class="clearfix">
</div>

In this part of the tutorial I&#8217;m going to show you how to integrate steps for Static Code Analysis (SCA). The quality of your code can easily be checked by using the following tools:

  * **FlexPMD** checks your code for violations of common conventions, such as unused variables, empty catch-blocks and so on.
  * **FlexCPD** checks your code for violations of the _DRY_&#8211; (Don&#8217;t Repeat Yourself&#8217;) Paradigma by detecting code duplications
  * **FlexMetrics** checks the ratio of LOC (lines of code) versus the lines used for comments, which can be useful to detect under- (or over-) documentation of your code.
  * **CLOC** reports languages used in your project and counts the single lines of code (LOC) used for each language (omitting comments of course)

Unfortunately, there is no tool to check test coverage. There used to be a tool called FlexCover, but it has not been maintained in a long time and I haven&#8217;t brought it to work. Cobertura, a popular tool to measure test coverage, does not support ActionScript (afaik), which leaves us with nothing to check the amount and location of untested code, which in my opinion is a pity.

<!--more-->

Nevertheless, let&#8217;s get started with the setup of the four tools mentioned above!

# Step 1: Getting the tools

First of all, you need to have the tools installed on your CI server. I recommend installing them at the same location on your local machine, which makes testing your build script a lot easier.

## FlexPMD, FlexCPD, FlexMetrics

Get the latest version from <a title="FlexPMD repository" href="http://opensource.adobe.com/svn/opensource/flexpmd/maven-repository/release/com/adobe/ac/flex-pmd/" target="_blank">Adobe&#8217;s repository</a> by downloading the ZIP-file called _flex-pmd-all-in-one-bundle-X.Y.zip_, whereas X and Y stand for the major resp. minor version number. This File contains FlexPMD, FlexCPD and FlexMetrics as well as a default ruleset to check your code. It also contains a tool called _violations-viewer_  which lets you look into the report generated by the three tools in a more readable format.

This tutorial assumes you have the contents of this ZIP-File at the following location:

`C:\tools\flexpmd`

<div id='stb-container-5679' class='stb-container-css stb-info-container stb-no-caption stb-image-big stb-ltr stb-side-none'>
  <aside class='stb-icon'><img src='http://www.tiefenauer.info/wp-content/plugins/wp-special-textboxes/themes/stb-metro/info.png' /></aside>
  
  <div id='stb-box-5679' class='stb-info_box stb-box' >
    If you want to create your own custom ruleset, there&#8217;s a neat tool from Adobe called Ruleset-Creator, which lets you create your own set of rules by enabling/disabling specific items. Check it out <a title="Ruleset Creator" href="http://opensource.adobe.com/svn/opensource/flexpmd/bin/flex-pmd-ruleset-creator.html" target="_blank">here</a>.
  </div>
</div>

## CLOC

We&#8217;re going to use CLOC as a tool for counting the lines of code in each language. You can dowload it <a title="CLOC Homepage" href="http://sourceforge.net/projects/cloc/files/" target="_blank">here</a>.

## Saxon

Unfortunately, the output created by CLOC cannot be parsed by a Jenkins plugin. However, there is a plugin for a tool called SLOCCount. However, this tool does not support AS3 as a language.

Since there is no plugin in Jenkins to visualize the output created with CLOC directly, we&#8217;re going to translate the XML created by CLOC to a format that can be parsed by the Jenkins SLOCCount-plugin. For this we use an XSL-Transformation file together with a tool called _Saxon_ which does the translation for us based on the Information contained in the XSL-File.

You can downlad Saxon Home Edition <a title="Saxon HE" href="http://sourceforge.net/projects/saxon/files/" target="_blank">here</a>.

### XML translation

As stated above, the XML translation is made with the help of a file called cloc2sloccount.xml, which holds the information on how to translate to a format which is equivalent to an output created with SLOCCount.

# Step 2: Defining the Ant-Tasks

As several times before, we need to define the tasks we&#8217;re going to use or Ant won&#8217;t recognize them and throw an error.

The observant reader might have noticed that there&#8217;s no Ant-task for CLOC. This is true and a bit sad, but not to worry about: The tool has a simple command line syntax and we&#8217;re going to execute it via Ant&#8217;s built-in `<exec>`-functionality.

## Expanding the build properties

To make our life a bit easier, we&#8217;re going to add some more variables to our `build.properties` file:

# Step 3: Adding to our build script

After downloading the tools and defining the ant tasks, executing the single steps is simple:

## FlexPMD Ant-task

<div id='stb-container-1428' class='stb-container-css stb-info-container stb-no-caption stb-image-big stb-ltr stb-side-none'>
  <aside class='stb-icon'><img src='http://www.tiefenauer.info/wp-content/plugins/wp-special-textboxes/themes/stb-metro/info.png' /></aside>
  
  <div id='stb-box-1428' class='stb-info_box stb-box' >
    The output created by FlexPMD is an XML file (here: <code>pmd.xml</code>), which can be parsed by the <a title="Jenkins PMD plugin" href="https://wiki.jenkins-ci.org/display/JENKINS/PMD+Plugin" target="_blank">Jenkins PMD plugin</a>. You can specify an (optional) <em>ruleset</em>-parameter which holds the path to your custom ruleset. If you omit it, a default ruleset is applied.
  </div>
</div>

## FlexCPD Ant-task

<div id='stb-container-6996' class='stb-container-css stb-info-container stb-no-caption stb-image-big stb-ltr stb-side-none'>
  <aside class='stb-icon'><img src='http://www.tiefenauer.info/wp-content/plugins/wp-special-textboxes/themes/stb-metro/info.png' /></aside>
  
  <div id='stb-box-6996' class='stb-info_box stb-box' >
    The output created by FlexPMD is an XML file (here: <code>cpd.xml</code>), which can be parsed by the <a title="Jenkins DRY plugin" href="https://wiki.jenkins-ci.org/display/JENKINS/DRY+Plugin" target="_blank">Jenkins DRY plugin</a>.
  </div>
</div>

## FlexMetrics Ant-task

<div id='stb-container-4811' class='stb-container-css stb-info-container stb-no-caption stb-image-big stb-ltr stb-side-none'>
  <aside class='stb-icon'><img src='http://www.tiefenauer.info/wp-content/plugins/wp-special-textboxes/themes/stb-metro/info.png' /></aside>
  
  <div id='stb-box-4811' class='stb-info_box stb-box' >
    The output created by FlexMetrics is an XML file (here: <code>metrics.xml</code>), which can be parsed by the <a title="Jenkins JavaNCSS Plugin" href="https://wiki.jenkins-ci.org/display/JENKINS/JavaNCSS+Plugin" target="_blank">Jenkins JavaNCSS plugin</a>. Don&#8217;t let the name fool you: the plugin can perfectly handle the output produced by FlexMetrics ;-).
  </div>
</div>

## CLOC/SLOCCount  Ant-task

The first step runs CLOC on our source directory, generating a file called cloc.xml which holds the information of the report.

The second steps transforms the cloc.xml to a format consistent with the SLOCCount output format and saves it in a file called sloccount.sc.

<div id='stb-container-3973' class='stb-container-css stb-info-container stb-no-caption stb-image-big stb-ltr stb-side-none'>
  <aside class='stb-icon'><img src='http://www.tiefenauer.info/wp-content/plugins/wp-special-textboxes/themes/stb-metro/info.png' /></aside>
  
  <div id='stb-box-3973' class='stb-info_box stb-box' >
    The output created by  the transformation can be parsed by the <a title="Jenkins SLOCCount Plugin" href="https://wiki.jenkins-ci.org/display/JENKINS/SLOCCount+Plugin" target="_blank">Jenkins SLOCCount plugin</a>.
  </div>
</div>

# Step 4: Testing everything out

To make sure everything works as expected install the plugins mentioned above, add some post-build steps to run the plugins on the newly created files and then run your job. You should get some nice charts and tables holding the information about the results.

# What we did so far

In this step we extended our build script by performing some common SCA tasks. By doing this we got information about the quality of our code in terms of violations of common coding-conventions, code duplication and code documentation. We also got an overview of the languages used in our app and the lines of code in each language.